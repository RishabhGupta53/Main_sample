data "azurerm_network_interface" "vm_nics" {
  for_each = {
    for item in flatten([
      for gw_key, gw in var.AppGateway : [
        for vm_pool_key, vm_names in gw.backend_pools_vm : [
          for vm in vm_names : {
            key   = "${gw_key}_${vm_pool_key}_${vm}"
            name  = gw.backend_vm_nic
            rg    = gw.backend_vm_rg
          }
        ]
      ]
    ]) : item.key => {
      name                = item.name
      resource_group_name = item.rg
    }
  }

  name                = each.value.name
  resource_group_name = each.value.resource_group_name
}
data "azurerm_app_service" "app_services" {
  for_each = {
    for item in flatten([
      for gw_key, gw in var.AppGateway : [
        for app_pool_key, app_names in gw.backend_pools_appservice : [
          for app in app_names : {
            key   = "${gw_key}_${app_pool_key}_${app}"
            name  = app
            rg    = gw.backend_app_service_rg
          }
        ]
      ]
    ]) : item.key => {
      name                = item.name
      resource_group_name = item.rg
    }
  }

  name                = each.value.name
  resource_group_name = each.value.resource_group_name
}
