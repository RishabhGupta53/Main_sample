function Build-BackendPools {
    param (
        [string]$backend_pool,
        [hashtable]$item
    )

    $backend_pools = @{}

    # Helper to build each section
    function Add-Entries {
        param (
            [string]$keyPrefix,
            [string]$csvValues
        )
        $i = 1
        foreach ($val in $csvValues.Split(',') | ForEach-Object { $_.Trim() }) {
            if ($val) {
                $key = "{0}_{1}_{2:D3}" -f $backend_pool, $keyPrefix, $i
                $backend_pools[$key] = @($val)
                $i++
            }
        }
    }

    Add-Entries -keyPrefix "ip" -csvValues $item.'backend_ips'
    Add-Entries -keyPrefix "fqdn" -csvValues $item.'backend_fqdns'
    Add-Entries -keyPrefix "vm" -csvValues $item.'backend_vm_name'
    Add-Entries -keyPrefix "appservice" -csvValues $item.'app_service_name'

    return $backend_pools
}
